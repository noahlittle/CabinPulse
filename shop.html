<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shop - CabinPulse</title>

  <!-- Primary Meta Tags -->
  <meta name="title" content="CabinPulse Shop - Expand Your Monitoring">
  <meta name="description" content="Add-Ons, accessories, and swag for your CabinPulse monitoring system. Water leak sensors, temperature monitors, and more.">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://cabinpulse.com/shop.html">
  <meta property="og:title" content="CabinPulse Shop - Expand Your Monitoring">
  <meta property="og:description" content="Add-Ons, accessories, and swag for your CabinPulse monitoring system. Water leak sensors, temperature monitors, and more.">
  <meta property="og:image" content="https://cabinpulse.com/shop-preview.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://cabinpulse.com/shop.html">
  <meta property="twitter:title" content="CabinPulse Shop - Expand Your Monitoring">
  <meta property="twitter:description" content="Add-Ons, accessories, and swag for your CabinPulse monitoring system. Water leak sensors, temperature monitors, and more.">
  <meta property="twitter:image" content="https://cabinpulse.com/shop-preview.png">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://js.stripe.com/v3/"></script>
  <script defer src="https://analytics.cabinliving.ca/script.js" data-website-id="bd58d7d8-2b00-44ae-8285-c76db6e383ad"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0a0f;
      --surface: #15151d;
      --elevated: #1f1f2b;
      --accent: #e94560;
      --accent-hover: #ff5a7c;
      --text: #ffffff;
      --text-dim: #9ba1b0;
      --border: rgba(255,255,255,0.06);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* Header */
    header {
      position: sticky;
      top: 0;
      background: rgba(10, 10, 15, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      z-index: 100;
    }

    nav {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1.25rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
      color: var(--text);
      font-weight: 700;
      font-size: 1.1rem;
      transition: opacity 0.2s;
    }

    .logo:hover { opacity: 0.8; }

    .logo img {
      width: 32px;
      height: 32px;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-dim);
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .back-btn:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .cart-btn {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .cart-btn:hover {
      border-color: var(--accent);
      background: var(--elevated);
    }

    .cart-count {
      position: absolute;
      top: -6px;
      right: -6px;
      background: var(--accent);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
    }

    .cart-count.active {
      display: flex;
    }

    /* Hero */
    .hero {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 2rem 2rem;
    }

    .hero h1 {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 800;
      letter-spacing: -0.02em;
      margin-bottom: 1rem;
      line-height: 1.1;
    }

    .hero p {
      font-size: 1.25rem;
      color: var(--text-dim);
      max-width: 600px;
    }

    /* Product Sections */
    .section {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 2rem;
    }

    .section-header {
      margin-bottom: 3rem;
    }

    .section-title {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .section-subtitle {
      color: var(--text-dim);
      font-size: 1rem;
    }

    /* Featured Product */
    .featured-product {
      position: relative;
      background: linear-gradient(135deg, #1f1f2b 0%, #2a1f2e 100%);
      border: 1px solid var(--border);
      border-radius: 24px;
      overflow: hidden;
      margin-bottom: 4rem;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .featured-product:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 60px rgba(233, 69, 96, 0.15);
    }

    .featured-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      align-items: center;
      gap: 3rem;
      padding: 4rem;
    }

    .featured-content h2 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .featured-content p {
      color: var(--text-dim);
      font-size: 1.1rem;
      margin-bottom: 2rem;
      line-height: 1.7;
    }

    .featured-price {
      font-size: 3rem;
      font-weight: 800;
      color: var(--accent);
      margin-bottom: 2rem;
    }

    .featured-list {
      list-style: none;
      margin-bottom: 2rem;
    }

    .featured-list li {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0;
      color: var(--text-dim);
    }

    .featured-list i {
      color: var(--accent);
      font-size: 1.1rem;
    }

    .featured-image {
      position: relative;
      aspect-ratio: 4/3;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .featured-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3));
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 2rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }

    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(233, 69, 96, 0.3);
    }

    /* Product Grid */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    .product-card {
      position: relative;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .product-card:hover {
      border-color: var(--accent);
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0,0,0,0.4);
    }

    .product-card.large { grid-column: span 6; }
    .product-card.medium { grid-column: span 4; }
    .product-card.small { grid-column: span 3; }

    .coming-soon {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.4rem 0.8rem;
      background: rgba(233, 69, 96, 0.15);
      border: 1px solid var(--accent);
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent);
    }

    .beta-tag {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.4rem 0.8rem;
      background: rgba(233, 69, 96, 0.15);
      border: 1px solid var(--accent);
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent);
    }

    .product-card.unavailable {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .product-card.unavailable:hover {
      transform: none;
      border-color: var(--border);
    }

    .product-image-wrap {
      aspect-ratio: 4/3;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1.5rem;
      border-radius: 12px;
    }

    .product-image-wrap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .product-info h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .product-info p {
      color: var(--text-dim);
      font-size: 0.9rem;
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .product-price {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .product-features {
      list-style: none;
      margin-bottom: 1rem;
    }

    .product-features li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: var(--text-dim);
      margin-bottom: 0.4rem;
    }

    .product-features i {
      color: var(--accent);
      font-size: 0.8rem;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(8px);
      z-index: 200;
      overflow-y: auto;
      padding: 2rem;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 24px;
      max-width: 1000px;
      width: 100%;
      position: relative;
      animation: modalIn 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
    }

    @keyframes modalIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .modal-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-dim);
      z-index: 10;
    }

    .modal-close:hover {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
      transform: rotate(90deg);
    }

    .modal-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      padding: 2.5rem;
      align-items: start;
    }

    /* Left side: Gallery */
    .modal-left {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* Right side: Info */
    .modal-right {
      display: flex;
      flex-direction: column;
    }

    /* Image Gallery */
    .gallery-container {
      width: 100%;
    }

    .main-image {
      aspect-ratio: 4/3;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      margin-bottom: 1rem;
      cursor: zoom-in;
      transition: all 0.2s;
    }

    .main-image:hover {
      background: rgba(255,255,255,0.04);
    }

    .main-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .image-thumbnails {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
    }

    .thumbnail {
      width: 70px;
      height: 70px;
      background: rgba(255,255,255,0.02);
      border: 2px solid transparent;
      border-radius: 8px;
      padding: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .thumbnail:hover {
      border-color: var(--text-dim);
    }

    .thumbnail.active {
      border-color: var(--accent);
      background: rgba(233, 69, 96, 0.1);
    }

    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Lightbox */
    .lightbox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      z-index: 300;
      align-items: center;
      justify-content: center;
    }

    .lightbox.active {
      display: flex;
    }

    .lightbox-content {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lightbox-image {
      max-width: 100%;
      max-height: 90vh;
      object-fit: contain;
    }

    .lightbox-close {
      position: absolute;
      top: -3rem;
      right: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.1);
      border: 1px solid var(--border);
      border-radius: 50%;
      cursor: pointer;
      color: white;
      transition: all 0.2s;
    }

    .lightbox-close:hover {
      background: var(--accent);
    }

    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.1);
      border: 1px solid var(--border);
      border-radius: 50%;
      cursor: pointer;
      color: white;
      transition: all 0.2s;
    }

    .lightbox-nav:hover {
      background: rgba(255,255,255,0.2);
    }

    .lightbox-prev {
      left: -70px;
    }

    .lightbox-next {
      right: -70px;
    }

    .modal-right h2 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .modal-price {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--accent);
      margin-bottom: 1.5rem;
    }

    .modal-description {
      color: var(--text-dim);
      line-height: 1.7;
      margin-bottom: 2rem;
    }

    .modal-features {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 0 2.5rem 2.5rem 2.5rem;
    }

    .modal-features h4 {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-dim);
      margin-bottom: 1rem;
    }

    .features-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .features-toggle {
      display: none;
      font-size: 1.25rem;
      color: var(--text-dim);
      transition: transform 0.2s;
    }

    .features-toggle.active {
      transform: rotate(45deg);
    }

    .features-list {
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .modal-features ul {
      list-style: none;
    }

    .modal-features li {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0;
      color: var(--text-dim);
    }

    .modal-features i {
      color: var(--accent);
    }

    /* Cart Sidebar */
    .cart-sidebar {
      position: fixed;
      right: -450px;
      top: 0;
      width: 450px;
      height: 100vh;
      background: var(--surface);
      border-left: 1px solid var(--border);
      z-index: 250;
      transition: right 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .cart-sidebar.active {
      right: 0;
    }

    .cart-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 240;
    }

    .cart-overlay.active {
      display: block;
    }

    .cart-header {
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cart-header h3 {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .cart-close {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-dim);
    }

    .cart-close:hover {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .cart-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-dim);
      text-align: center;
      padding: 2rem;
    }

    .cart-empty i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    .cart-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 1rem;
    }

    .cart-item-image {
      width: 80px;
      height: 80px;
      background: rgba(255,255,255,0.02);
      border-radius: 8px;
      padding: 0.5rem;
      flex-shrink: 0;
    }

    .cart-item-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .cart-item-details {
      flex: 1;
    }

    .cart-item-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .cart-item-price {
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .qty-btn {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text);
      font-size: 0.85rem;
    }

    .qty-btn:hover {
      background: var(--accent);
      border-color: var(--accent);
    }

    .qty-value {
      min-width: 30px;
      text-align: center;
      font-weight: 600;
    }

    .remove-btn {
      margin-left: auto;
      color: var(--text-dim);
      cursor: pointer;
      padding: 0.5rem;
      transition: color 0.2s;
    }

    .remove-btn:hover {
      color: var(--accent);
    }

    .cart-footer {
      padding: 2rem;
      border-top: 1px solid var(--border);
    }

    .cart-shipping {
      padding: 1.5rem 2rem;
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
    }

    .cart-shipping h4 {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .shipping-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .shipping-toggle {
      display: none;
      font-size: 1rem;
      color: var(--text-dim);
      transition: transform 0.2s;
    }

    .shipping-toggle.active {
      transform: rotate(180deg);
    }

    .shipping-options-container {
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .shipping-option-cart {
      background: rgba(255,255,255,0.02);
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 0.875rem;
      margin-bottom: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .shipping-option-cart:hover {
      border-color: var(--text-dim);
      background: rgba(255,255,255,0.04);
    }

    .shipping-option-cart.selected {
      border-color: var(--accent);
      background: rgba(233, 69, 96, 0.1);
    }

    .shipping-option-cart-info {
      flex: 1;
    }

    .shipping-option-cart-name {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }

    .shipping-option-cart-days {
      font-size: 0.75rem;
      color: var(--text-dim);
    }

    .shipping-option-cart-price {
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent);
    }

    .cart-summary {
      padding: 1.5rem 2rem;
    }

    .cart-summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      font-size: 0.95rem;
    }

    .cart-summary-row.total {
      font-size: 1.5rem;
      font-weight: 700;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border);
      margin-top: 0.75rem;
    }

    .cart-total-amount {
      color: var(--accent);
    }

    .tax-note {
      font-size: 0.75rem;
      color: var(--text-dim);
      text-align: center;
      margin-bottom: 1rem;
    }

    .checkout-btn {
      width: 100%;
      padding: 1rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .checkout-btn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(233, 69, 96, 0.3);
    }

    .checkout-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Size Selector */
    .size-selector {
      margin-bottom: 1.5rem;
    }

    .size-selector h4 {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--text-dim);
    }

    .size-options {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .size-option {
      padding: 0.625rem 1.25rem;
      background: rgba(255,255,255,0.02);
      border: 2px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .size-option:hover {
      border-color: var(--text-dim);
      background: rgba(255,255,255,0.04);
    }

    .size-option.selected {
      border-color: var(--accent);
      background: rgba(233, 69, 96, 0.1);
      color: var(--accent);
    }

    /* Info Banner */
    .info-banner {
      background: linear-gradient(135deg, rgba(233, 69, 96, 0.1) 0%, rgba(233, 69, 96, 0.05) 100%);
      border: 1px solid rgba(233, 69, 96, 0.3);
      border-radius: 16px;
      padding: 1.5rem 2rem;
      margin-bottom: 3rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
    }

    .info-banner-image {
      width: 120px;
      height: 120px;
      flex-shrink: 0;
    }

    .info-banner-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.2));
    }

    .info-banner-content {
      flex: 1;
    }

    .info-banner h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .info-banner p {
      color: var(--text-dim);
      font-size: 0.95rem;
    }

    .info-banner-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      white-space: nowrap;
    }

    .info-banner-btn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(233, 69, 96, 0.3);
    }

    /* Footer */
    footer {
      max-width: 1400px;
      margin: 4rem auto 0;
      padding: 3rem 2rem 2rem;
      border-top: 1px solid var(--border);
    }

    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .footer-links {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .footer-links a {
      color: var(--text-dim);
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.2s;
    }

    .footer-links a:hover {
      color: var(--accent);
    }

    .footer-bottom {
      color: var(--text-dim);
      font-size: 0.85rem;
      text-align: center;
      padding-top: 2rem;
      border-top: 1px solid var(--border);
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .product-card.large,
      .product-card.medium {
        grid-column: span 6;
      }
    }

    @media (max-width: 900px) {
      .info-banner {
        flex-direction: column;
        align-items: flex-start;
        padding: 1.25rem 1.5rem;
      }

      .info-banner-image {
        display: none;
      }

      .info-banner-btn {
        width: 100%;
        justify-content: center;
      }

      footer {
        text-align: center;
      }

      .footer-content {
        flex-direction: column;
        align-items: center;
        gap: 2rem;
      }

      .footer-links {
        flex-direction: column;
        gap: 1rem;
        align-items: center;
      }

      .featured-banner-content {
        grid-template-columns: 1fr;
        padding: 1.5rem;
        gap: 1.5rem;
      }

      .banner-text h2 {
        font-size: 1.5rem;
      }

      .banner-text p {
        font-size: 0.9rem;
      }

      .banner-price {
        font-size: 1.75rem;
      }

      .banner-cta {
        align-items: flex-start;
      }

      .banner-image {
        order: -1;
      }

      .product-card.large,
      .product-card.medium,
      .product-card.small {
        grid-column: span 12;
      }

      /* Full screen modal on mobile */
      .modal {
        padding: 0;
        align-items: stretch;
      }

      .modal-content {
        max-width: 100%;
        max-height: 100vh;
        border-radius: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .modal-grid {
        grid-template-columns: 1fr;
        padding: 1.5rem;
        gap: 1.5rem;
        flex: 1;
        overflow-y: auto;
      }

      .modal-features {
        margin: 0 1.5rem 1.5rem 1.5rem;
      }

      .modal-features h4 {
        margin-bottom: 0;
      }

      .modal-close {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background: rgba(0,0,0,0.7);
        z-index: 10;
      }

      .cart-sidebar {
        width: 100%;
        right: -100%;
      }

      /* Collapsible features on mobile */
      .features-toggle {
        display: block;
      }

      .features-list {
        max-height: 0;
        margin-top: 0;
      }

      .features-list.expanded {
        max-height: 500px;
        margin-top: 1rem;
      }

      /* Collapsible shipping on mobile */
      .shipping-toggle {
        display: block;
      }

      .shipping-options-container {
        max-height: 0;
      }

      .shipping-options-container.expanded {
        max-height: 500px;
      }

      .lightbox-prev {
        left: 10px;
      }

      .lightbox-next {
        right: 10px;
      }
    }

    @media (max-width: 600px) {
      nav {
        padding: 1rem;
      }

      .hero {
        padding: 3rem 1rem 2rem;
      }

      .section {
        padding: 2rem 1rem;
      }

      .featured-grid {
        padding: 1.5rem;
      }

      .featured-price {
        font-size: 2rem;
      }

      .modal-grid {
        padding: 1.5rem;
      }

      .modal-features {
        margin: 0 1.5rem 1.5rem 1.5rem;
      }

      .cart-items {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>

  <header>
    <nav>
      <a href="index.html" class="logo">
        <img src="cpicon.png" alt="CabinPulse">
      </a>
      <div class="nav-actions">
        <div class="cart-btn" onclick="toggleCart()">
          <i class="fas fa-shopping-cart"></i>
          <span>Cart</span>
          <span class="cart-count" id="cart-count">0</span>
        </div>
      </div>
    </nav>
  </header>

  <div class="hero">
    <h1>CabinPulse Shop</h1>
    <p>Expand your monitoring with Add-Ons, accessories and more</p>
  </div>

  <section class="section">

    <div class="info-banner">
      <div class="info-banner-image">
        <img src="product-1.png" alt="CabinPulse Device">
      </div>
      <div class="info-banner-content">
        <h3>Don't have a CabinPulse yet?</h3>
        <p>Come back once you have your device to expand monitoring with Add-Ons and accessories.</p>
      </div>
      <a href="https://cabinpulse.com/purchase.html" class="info-banner-btn">
        Get CabinPulse
        <i class="fas fa-arrow-right"></i>
      </a>
    </div>

    <div class="section-header">
      <h2 class="section-title">Add-Ons</h2>
      <p class="section-subtitle">Wireless battery-powered sensors that connect to your existing CabinPulse device. No additional subscription required.</p>
    </div>

    <div class="products-grid">
      <div class="product-card large" onclick="openModal('leak-sensor')">
        <span class="beta-tag">New</span>
        <div class="product-image-wrap">
          <img src="shop/leak.png" alt="Leak Sensor">
        </div>
        <div class="product-info">
          <h3>Leak Sensor Add-On</h3>
          <p>Instant detection and alerts for water leaks anywhere in your property</p>
          <div class="product-price">$49 CAD</div>
          <ul class="product-features">
            <li><i class="fas fa-circle-check"></i> 30m+ wireless range</li>
            <li><i class="fas fa-circle-check"></i> Up to 3-year battery life with replaceable 2x AA Lithium</li>
            <li><i class="fas fa-circle-check"></i> Instant alerts</li>
            <li><i class="fas fa-circle-check"></i> Optional Leak Cable</li>
          </ul>
        </div>
      </div>

      <div class="product-card large" onclick="openModal('temp-sensor')">
        <span class="beta-tag">New</span>
        <div class="product-image-wrap">
          <img src="shop/temp.png" alt="Temperature Sensor">
        </div>
        <div class="product-info">
          <h3>Temperature Add-On</h3>
          <p>Monitor temperature in additional locations without power</p>
          <div class="product-price">$59 CAD</div>
          <ul class="product-features">
            <li><i class="fas fa-circle-check"></i> 30m+ wireless range</li>
            <li><i class="fas fa-circle-check"></i> Up to 5-year battery life with replaceable 4x AA Lithium</li>
            <li><i class="fas fa-circle-check"></i> Instant alerts</li>
            <li><i class="fas fa-circle-check"></i> Temperature update every 6 hours when not in alert state</li>
            <li><i class="fas fa-circle-check"></i> ±0.1°C accuracy</li>
          </ul>
        </div>
      </div>

      <div class="product-card medium" onclick="openModal('climate-sensor')">
        <span class="beta-tag">New</span>
        <div class="product-image-wrap">
          <img src="shop/temp.png" alt="Climate Sensor">
        </div>
        <div class="product-info">
          <h3>Climate Add-On</h3>
          <p>Temperature + humidity monitoring</p>
          <div class="product-price">$79 CAD</div>
        </div>
      </div>

      <div class="product-card medium unavailable">
        <span class="coming-soon">Available Soon</span>
        <div class="product-image-wrap">
          <img src="shop/motion.png" alt="Motion Sensor">
        </div>
        <div class="product-info">
          <h3>Motion Detector</h3>
          <p>Security monitoring with adjustable sensitivity</p>
          <div class="product-price">$59 CAD</div>
        </div>
      </div>

      <div class="product-card medium unavailable">
        <span class="coming-soon">Available Soon</span>
        <div class="product-image-wrap">
          <img src="shop/door.png" alt="Door Sensor">
        </div>
        <div class="product-info">
          <h3>Door/Window Sensor</h3>
          <p>Know when doors or windows open</p>
          <div class="product-price">$49 CAD</div>
        </div>
      </div>

      <div class="product-card medium unavailable">
        <span class="coming-soon">Available Soon</span>
        <div class="product-image-wrap">
          <img src="shop/switch.png" alt="Remote Switch">
        </div>
        <div class="product-info">
          <h3>Remote Switch</h3>
          <p>Switch devices on and off remotely</p>
          <div class="product-price">$59 CAD</div>
        </div>
      </div>
    </div>

    <div class="info-banner" style="margin-top: 3rem;">
      <div class="info-banner-content">
        <h3>Want to see more Add-Ons?</h3>
        <p>We'll take suggestions! If you have a specific monitoring need, let us know and we'll see what we can do.</p>
      </div>
      <a href="mailto:support@cabinpulse.com?subject=Add-On Suggestion" class="info-banner-btn">
        Suggest an Add-On
        <i class="fas fa-lightbulb"></i>
      </a>
    </div>

    <div class="section-header" style="margin-top:3rem;">
      <h2 class="section-title"> Accessories</h2>
      <p class="section-subtitle">Extras, accessories and alternative power solutions for your CabinPulse device</p>
    </div>

    <div class="products-grid">
      <div class="product-card small" onclick="openModal('wall-mount')">
        <div class="product-image-wrap">
          <img src="shop/mount.png" alt="Wall Mount">
        </div>
        <div class="product-info">
          <h3>CabinPulse Mount</h3>
          <p>Wall mount for your CabinPulse device.</p>
          <div class="product-price">$19 CAD</div>
        </div>
      </div>
      <div class="product-card small" onclick="openModal('wall-adapter')">
        <div class="product-image-wrap">
          <img src="shop/wall-2.png" alt="Wall Adapter">
        </div>
        <div class="product-info">
          <h3>Wall Power Adapter</h3>
          <p>Extra power adapter with 6ft cable</p>
          <div class="product-price">$19 CAD</div>
        </div>
      </div>

      <div class="product-card small" onclick="openModal('usb-adapter')">
        <div class="product-image-wrap">
          <img src="shop/usb.png" alt="USB Adapter">
        </div>
        <div class="product-info">
          <h3>USB Cable</h3>
          <p>12in USB power cable</p>
          <div class="product-price">$9 CAD</div>
        </div>
      </div>

      <div class="product-card small" onclick="openModal('12v-adapter')">
        <div class="product-image-wrap">
          <img src="shop/buck.png" alt="12V Adapter">
        </div>
        <div class="product-info">
          <h3>12V/24V Adapter</h3>
          <p>For battery systems & RVs</p>
          <div class="product-price">$24 CAD</div>
        </div>
      </div>

      <div class="product-card small" onclick="openModal('leak-cable')">
        <span class="coming-soon">NEW</span>
        <div class="product-image-wrap">
          <img src="shop/leak-cable.png" alt="Leak Cable">
        </div>
        <div class="product-info">
          <h3>Leak Detection Cable</h3>
          <p>Works with Leak Sensor Add On for hard-to-reach leak monitoring</p>
          <div class="product-price">$19 CAD</div>
        </div>
      </div>
          </div>

    <div class="section-header" style="margin-top:3rem;">
      <h2 class="section-title">Swag</h2>
      <p class="section-subtitle">CabinPulse branded merchandise</p>
    </div>

    <div class="products-grid">
      <div class="product-card small" onclick="openModal('tshirt')">
        <div class="product-image-wrap">
          <img src="shop/tshirt.png" alt="CabinPulse T-Shirt">
        </div>
        <div class="product-info">
          <h3>CabinPulse T-Shirt</h3>
          <p>Premium cotton tee with logo</p>
          <div class="product-price">$29 CAD</div>
        </div>
      </div>

      <div class="product-card small" onclick="openModal('hat')">
        <div class="product-image-wrap">
          <img src="shop/hat.png" alt="CabinPulse Hat">
        </div>
        <div class="product-info">
          <h3>CabinPulse Hat</h3>
          <p>Low profile garment-washed cotton twill hat</p>
          <div class="product-price">$26 CAD</div>
        </div>
      </div>

      <div class="product-card small" onclick="openModal('mug')">
        <div class="product-image-wrap">
          <img src="shop/mug.png" alt="CabinPulse Mug">
        </div>
        <div class="product-info">
          <h3>CabinPulse Mug</h3>
          <p>Ceramic 12oz coffee mug</p>
          <div class="product-price">$19 CAD</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Cart Overlay -->
  <div class="cart-overlay" id="cart-overlay" onclick="toggleCart()"></div>

  <!-- Cart Sidebar -->
  <div class="cart-sidebar" id="cart-sidebar">
    <div class="cart-header">
      <h3>Your Cart</h3>
      <div class="cart-close" onclick="toggleCart()">
        <i class="fas fa-times"></i>
      </div>
    </div>
    <div class="cart-items" id="cart-items">
      <div class="cart-empty">
        <i class="fas fa-shopping-cart"></i>
        <p>Your cart is empty</p>
      </div>
    </div>
    <div class="cart-shipping" id="cart-shipping-section" style="display: none;">
      <div class="shipping-header" onclick="toggleShipping()">
        <h4>Shipping Method</h4>
        <i class="fas fa-chevron-down shipping-toggle" id="shipping-toggle"></i>
      </div>
      <div class="shipping-options-container" id="shipping-options-container">
        <div class="shipping-option-cart" data-shipping="standard" onclick="selectCartShipping('standard')">
          <div class="shipping-option-cart-info">
            <div class="shipping-option-cart-name">Standard Shipping</div>
            <div class="shipping-option-cart-days">3-7 business days</div>
          </div>
          <div class="shipping-option-cart-price">$10</div>
        </div>
        <div class="shipping-option-cart" data-shipping="express" onclick="selectCartShipping('express')">
          <div class="shipping-option-cart-info">
            <div class="shipping-option-cart-name">Express Shipping</div>
            <div class="shipping-option-cart-days">1-3 business days</div>
          </div>
          <div class="shipping-option-cart-price">$20</div>
        </div>
        <div style="font-size: 0.75rem; color: var(--text-dim); margin-top: 0.75rem; text-align: center;">Ships to Canada and USA only</div>
      </div>
    </div>
    <div class="cart-summary" id="cart-summary" style="display: none;">
      <div class="cart-summary-row">
        <span>Subtotal</span>
        <span id="cart-subtotal">$0 CAD</span>
      </div>
      <div class="cart-summary-row">
        <span>Shipping</span>
        <span id="cart-shipping-cost">-</span>
      </div>
      <div class="cart-summary-row total">
        <span>Total</span>
        <span class="cart-total-amount" id="cart-total">$0 CAD</span>
      </div>
      <div class="tax-note">Taxes calculated at checkout</div>
      <button class="checkout-btn" id="checkout-btn" onclick="checkout()" disabled>
        Proceed to Checkout
      </button>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <div class="lightbox-content">
      <div class="lightbox-close" onclick="closeLightbox()">
        <i class="fas fa-times"></i>
      </div>
      <div class="lightbox-nav lightbox-prev" onclick="lightboxPrev()">
        <i class="fas fa-chevron-left"></i>
      </div>
      <img class="lightbox-image" id="lightbox-image" src="" alt="">
      <div class="lightbox-nav lightbox-next" onclick="lightboxNext()">
        <i class="fas fa-chevron-right"></i>
      </div>
    </div>
  </div>

  <!-- Product Modals will be inserted by JavaScript -->
  <div id="modals"></div>

  <footer>
    <div class="footer-content">
      <div class="footer-links">
        <a href="https://cabinpulse.com">Home</a>
        <a href="https://cabinpulse.com/purchase.html">Purchase CabinPulse</a>
        <a href="https://cabinpulse.com/legal.html">Privacy Policy</a>
        <a href="https://cabinpulse.com/legal.html">Terms of Service</a>
        <a href="mailto:support@cabinpulse.com">Contact</a>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; 2025 CabinPulse. All rights reserved.
    </div>
  </footer>

  <script>
    // Product data with multiple images
    const products = {
      'leak-sensor': {
        name: 'Leak Sensor Add-On',
        price: 49,
        images: ['shop/leak.png', 'shop/leak-2.png', 'shop/leak-sc.png'],
        description: 'Wireless water leak detection that alerts you the moment moisture is detected. Perfect for water heaters, under sinks, basements, and anywhere water damage is a concern.',
        features: [
          '30m+ wireless range',
          '24-month battery life (AA batteries)',
          'Instant leak detection alerts',
          'No additional subscription'
        ],
        priceId: 'price_LEAK'
      },
      'temp-sensor': {
        name: 'Temperature Add-On',
        price: 59,
        images: ['shop/temp.png', 'shop/temp-sc.png'],
        description: 'Extend temperature monitoring to additional rooms or locations. Precision ±0.1°C temperature sensor.',
        features: [
          '±0.1°C precision accuracy',
          '30m+ range',
          'Up to 3 year battery life',
          'Set high and low thresholds',
          'Instant temperature alerts'
        ],
        priceId: 'price_TEMP'
      },
      'wall-adapter': {
        name: 'Wall Power Adapter',
        price: 19,
        images: ['shop/wall-2.png'],
        description: 'Replacement or additional power adapter with extra-long 6ft cable. UL certified for safe, reliable power delivery.',
        features: [
          '6ft micro USB cable',
          'UL certified',
          '5V 3A output',
          '100-240V input'
        ],
        priceId: 'price_WALL'
      },
      'wall-mount': {
        name: 'Wall Mount',
        price: 19,
        images: ['shop/mount.png', 'shop/mount-2.png'],
        description: 'Wall mount for your CabinPulse device',
        features: [
          'Securely holds your device',
          'Easy installation via adhesive or screws',
          'Durable materials',
          'Made in Canada'
        ],
        priceId: 'price_WALL'
      },
      'temp-plus-sensor': {
        name: 'Temperature+ Add-On',
        price: 69,
        images: ['shop/temp-plus.png', 'shop/temp-plus-sc.png'],
        description: 'Monitor both temperature and humidity in additional locations. Perfect for detecting conditions that could lead to mold, monitoring indoor comfort levels, or protecting humidity-sensitive items.',
        features: [
          '±1°C temperature accuracy',
          '±3% RH humidity accuracy',
          '30m+ wireless range',
          'Up to 3 year battery life (4x AA Lithium)',
          'Set high and low thresholds for both sensors',
          'Instant temperature and humidity alerts'
        ],
        priceId: 'price_TEMP_PLUS'
      },
      'usb-adapter': {
        name: 'USB Power Cable',
        price: 9,
        images: ['shop/usb.png'],
        description: '12in USB cable for powering CabinPulse from USB ports or battery banks. Perfect for portable installations.',
        features: [
          '12in micro USB cable',
          'USB-A connector',
          'Battery bank compatible'
        ],
        priceId: 'price_USB'
      },
      '12v-adapter': {
        name: '12V/24V Power Adapter',
        price: 24,
        images: ['shop/buck.png'],
        description: 'Connect CabinPulse to 12V or 24V battery systems, solar setups, or vehicle power. Ideal for RVs and off-grid installations.',
        features: [
          '12V/24V DC to 5V conversion',
          'Solar system compatible',
        ],
        priceId: 'price_12V'
      },
      'leak-cable': {
        name: 'Leak Cable',
        price: 19,
        images: ['shop/leak-cable.png'],
        description: 'Extend leak detection capabilities of the Leak Sensor with this 1m cable. Perfect for hard-to-reach areas like behind appliances or under flooring.',
        features: [
          '1m length',
          'Compatible with Leak Sensor Add On',
        ],
        priceId: 'price_LEAK_CABLE'
      },
      'tshirt': {
        name: 'CabinPulse T-Shirt',
        price: 29,
        images: ['shop/tshirt.png'],
        description: 'High-quality cotton t-shirt featuring the CabinPulse logo. Comfortable, durable, and perfect for showing your support.',
        features: [
          '100% premium cotton',
          'Available in S-XXL',
          'Screen-printed logo',
          'Gildan® Softstyle®'
        ],
        sizes: ['S', 'M', 'L', 'XL', 'XXL'],
        priceId: 'price_TSHIRT'
      },
      'hat': {
        name: 'CabinPulse Hat',
        price: 26,
        images: ['shop/hat.png'],
        description: 'Garment-washed cotton twill hat with low profile fit.',
        features: [
          '100% cotton twill',
          'Embroidered CabinPulse logo',
          'One size fits most',
          'Adjustable slide closure with buckle and grommet'
        ],
        priceId: 'price_HAT'
      },
      'mug': {
        name: 'CabinPulse Mug',
        price: 19,
        images: ['shop/mug.png'],
        description: '11oz ceramic coffee mug with CabinPulse branding. Microwave and dishwasher safe.',
        features: [
          '11oz ceramic',
          'Microwave safe',
          'Dishwasher safe',
          'Durable print'
        ],
        priceId: 'price_MUG'
      },
    };

    let cart = JSON.parse(localStorage.getItem('cabinpulse-cart') || '[]');
    let currentProductImages = [];
    let currentImageIndex = 0;
    let selectedShippingMethod = null;
    let selectedSizes = {}; // Track selected size for each product

    // Generate modals
    function generateModals() {
      const modalsContainer = document.getElementById('modals');
      
      Object.keys(products).forEach(id => {
        const product = products[id];
        
        const modal = document.createElement('div');
        modal.id = id;
        modal.className = 'modal';
        modal.innerHTML = `
          <div class="modal-content">
            <div class="modal-close" onclick="closeModal('${id}')">
              <i class="fas fa-times"></i>
            </div>
            <div class="modal-grid">
              <div class="modal-left">
                <div class="gallery-container">
                  <div class="main-image" onclick="openLightboxFromCurrent('${id}')">
                    <img src="${product.images[0]}" alt="${product.name}" id="${id}-main-img" data-current-index="0">
                  </div>
                  <div class="image-thumbnails" id="${id}-thumbnails">
                    ${product.images.map((img, i) => `
                      <div class="thumbnail ${i === 0 ? 'active' : ''}" onclick="changeImage('${id}', ${i})">
                        <img src="${img}" alt="${product.name}">
                      </div>
                    `).join('')}
                  </div>
                </div>
              </div>
              <div class="modal-right">
                <h2>${product.name}</h2>
                <div class="modal-price">$${product.price} CAD</div>
                <p class="modal-description">${product.description}</p>
                ${product.sizes ? `
                  <div class="size-selector">
                    <h4>Select Size</h4>
                    <div class="size-options" id="${id}-size-options">
                      ${product.sizes.map(size => `
                        <div class="size-option" onclick="selectSize('${id}', '${size}')">${size}</div>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}
                <button class="btn" style="width:100%;" id="${id}-add-btn" onclick="addToCart('${id}')" ${product.sizes ? 'disabled' : ''}>
                  <i class="fas fa-shopping-cart"></i>
                  Add to Cart
                </button>
              </div>
            </div>
            <div class="modal-features">
              <div class="features-header" onclick="toggleFeatures('${id}')">
                <h4>Features</h4>
                <i class="fas fa-plus features-toggle" id="${id}-features-toggle"></i>
              </div>
              <div class="features-list" id="${id}-features-list">
                <ul>
                  ${product.features.map(f => `<li><i class="fas fa-check"></i> ${f}</li>`).join('')}
                </ul>
              </div>
            </div>
          </div>
        `;
        
        modalsContainer.appendChild(modal);
      });
    }

    function changeImage(productId, index) {
      const product = products[productId];
      document.getElementById(`${productId}-main-img`).src = product.images[index];
      document.getElementById(`${productId}-main-img`).dataset.currentIndex = index;

      // Update thumbnails
      const thumbnails = document.querySelectorAll(`#${productId}-thumbnails .thumbnail`);
      thumbnails.forEach((thumb, i) => {
        thumb.classList.toggle('active', i === index);
      });
    }

    function openLightboxFromCurrent(productId) {
      // Get the current image index from the main image
      const mainImg = document.getElementById(`${productId}-main-img`);
      const currentIndex = parseInt(mainImg.dataset.currentIndex || 0);
      openLightbox(productId, currentIndex);
    }

    function openLightbox(productId, startIndex) {
      currentProductImages = products[productId].images;
      currentImageIndex = startIndex;
      document.getElementById('lightbox-image').src = currentProductImages[currentImageIndex];
      document.getElementById('lightbox').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      document.getElementById('lightbox').classList.remove('active');
      document.body.style.overflow = '';
    }

    function lightboxPrev() {
      currentImageIndex = (currentImageIndex - 1 + currentProductImages.length) % currentProductImages.length;
      document.getElementById('lightbox-image').src = currentProductImages[currentImageIndex];
    }

    function lightboxNext() {
      currentImageIndex = (currentImageIndex + 1) % currentProductImages.length;
      document.getElementById('lightbox-image').src = currentProductImages[currentImageIndex];
    }

    function openModal(id) {
      document.getElementById(id).classList.add('active');
      document.body.style.overflow = 'hidden';

      // Update URL without reloading page
      const url = new URL(window.location);
      url.searchParams.set('product', id);
      window.history.pushState({}, '', url);
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
      document.body.style.overflow = '';

      // Remove product parameter from URL
      const url = new URL(window.location);
      url.searchParams.delete('product');
      window.history.pushState({}, '', url);
    }

    function toggleCart() {
      document.getElementById('cart-sidebar').classList.toggle('active');
      document.getElementById('cart-overlay').classList.toggle('active');
    }

    function toggleShipping() {
      // Only toggle on mobile (when toggle icon is visible)
      const toggle = document.getElementById('shipping-toggle');
      const container = document.getElementById('shipping-options-container');

      if (window.getComputedStyle(toggle).display !== 'none') {
        container.classList.toggle('expanded');
        toggle.classList.toggle('active');
      }
    }

    function toggleFeatures(productId) {
      // Only toggle on mobile (when toggle icon is visible)
      const toggle = document.getElementById(`${productId}-features-toggle`);
      const list = document.getElementById(`${productId}-features-list`);

      if (window.getComputedStyle(toggle).display !== 'none') {
        list.classList.toggle('expanded');
        toggle.classList.toggle('active');
      }
    }

    function selectSize(productId, size) {
      selectedSizes[productId] = size;

      // Update UI
      const sizeOptions = document.querySelectorAll(`#${productId}-size-options .size-option`);
      sizeOptions.forEach(opt => {
        opt.classList.toggle('selected', opt.textContent === size);
      });

      // Enable add to cart button
      document.getElementById(`${productId}-add-btn`).disabled = false;
    }

    function addToCart(productId) {
      const product = products[productId];
      const selectedSize = selectedSizes[productId];

      // Create a unique key combining product ID and size (if applicable)
      const cartKey = selectedSize ? `${productId}-${selectedSize}` : productId;
      const existingItem = cart.find(item => item.cartKey === cartKey);

      if (existingItem) {
        existingItem.quantity++;
      } else {
        cart.push({
          id: productId,
          cartKey: cartKey,
          name: product.name,
          price: product.price,
          image: product.images[0],
          priceId: product.priceId,
          size: selectedSize,
          quantity: 1
        });
      }

      saveCart();
      updateCartUI();
      closeModal(productId);
      toggleCart();

      // Reset size selection
      delete selectedSizes[productId];
    }

    function updateQuantity(cartKey, delta) {
      const item = cart.find(item => item.cartKey === cartKey);
      if (item) {
        item.quantity += delta;
        if (item.quantity <= 0) {
          removeFromCart(cartKey);
        } else {
          saveCart();
          updateCartUI();
        }
      }
    }

    function removeFromCart(cartKey) {
      cart = cart.filter(item => item.cartKey !== cartKey);
      saveCart();
      updateCartUI();
    }

    function saveCart() {
      localStorage.setItem('cabinpulse-cart', JSON.stringify(cart));
    }

    function selectCartShipping(method) {
      selectedShippingMethod = method;

      // Update visual selection
      document.querySelectorAll('.shipping-option-cart').forEach(opt => {
        opt.classList.remove('selected');
      });
      document.querySelector(`[data-shipping="${method}"]`).classList.add('selected');

      // Update totals
      updateCartTotals();

      // Auto-collapse on mobile after selection
      const toggle = document.getElementById('shipping-toggle');
      const container = document.getElementById('shipping-options-container');
      if (window.getComputedStyle(toggle).display !== 'none' && container.classList.contains('expanded')) {
        container.classList.remove('expanded');
        toggle.classList.remove('active');
      }
    }

    function updateCartTotals() {
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const shippingCost = selectedShippingMethod === 'express' ? 20 : (selectedShippingMethod === 'standard' ? 10 : 0);
      const total = subtotal + shippingCost;

      document.getElementById('cart-subtotal').textContent = `$${subtotal.toFixed(2)} CAD`;
      document.getElementById('cart-shipping-cost').textContent = selectedShippingMethod ? `$${shippingCost} CAD` : '-';
      document.getElementById('cart-total').textContent = `$${total.toFixed(2)} CAD`;

      // Enable checkout only if shipping is selected
      document.getElementById('checkout-btn').disabled = !selectedShippingMethod;
    }

    function updateCartUI() {
      const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);

      const cartCountEl = document.getElementById('cart-count');
      cartCountEl.textContent = cartCount;
      cartCountEl.classList.toggle('active', cartCount > 0);

      const cartItems = document.getElementById('cart-items');
      const shippingSection = document.getElementById('cart-shipping-section');
      const summarySection = document.getElementById('cart-summary');

      if (cart.length === 0) {
        cartItems.innerHTML = `
          <div class="cart-empty">
            <i class="fas fa-shopping-cart"></i>
            <p>Your cart is empty</p>
          </div>
        `;
        shippingSection.style.display = 'none';
        summarySection.style.display = 'none';
        selectedShippingMethod = null;
      } else {
        cartItems.innerHTML = cart.map(item => `
          <div class="cart-item">
            <div class="cart-item-image">
              <img src="${item.image}" alt="${item.name}">
            </div>
            <div class="cart-item-details">
              <div class="cart-item-name">${item.name}${item.size ? ` (${item.size})` : ''}</div>
              <div class="cart-item-price">$${item.price} CAD</div>
              <div class="cart-item-controls">
                <div class="qty-btn" onclick="updateQuantity('${item.cartKey}', -1)">
                  <i class="fas fa-minus"></i>
                </div>
                <div class="qty-value">${item.quantity}</div>
                <div class="qty-btn" onclick="updateQuantity('${item.cartKey}', 1)">
                  <i class="fas fa-plus"></i>
                </div>
                <div class="remove-btn" onclick="removeFromCart('${item.cartKey}')">
                  <i class="fas fa-trash"></i>
                </div>
              </div>
            </div>
          </div>
        `).join('');

        shippingSection.style.display = 'block';
        summarySection.style.display = 'block';

        // Select standard shipping by default if nothing selected
        if (!selectedShippingMethod) {
          selectCartShipping('standard');
        } else {
          updateCartTotals();
        }
      }
    }

    async function checkout() {
      if (!selectedShippingMethod) {
        alert('Please select a shipping method');
        return;
      }

      const checkoutBtn = document.getElementById('checkout-btn');
      checkoutBtn.disabled = true;
      checkoutBtn.textContent = 'Processing...';

      try {
        // Only send product IDs, quantities, and sizes - NOT prices
        // Backend will validate and look up the actual prices
        const secureItems = cart.map(item => ({
          productId: item.id,
          quantity: item.quantity,
          size: item.size || null
        }));

        // Send cart and shipping selection to backend
        const response = await fetch('https://cabinpulse.com/api/create-shop-checkout-session', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            items: secureItems,
            shipping_method: selectedShippingMethod
          })
        });

        const data = await response.json();

        if (data.error) {
          alert('Error: ' + data.error);
          checkoutBtn.disabled = false;
          checkoutBtn.textContent = 'Proceed to Checkout';
          return;
        }

        // Redirect to Stripe Checkout
        const stripe = Stripe(data.publishableKey);
        const { error } = await stripe.redirectToCheckout({
          sessionId: data.sessionId
        });

        if (error) {
          alert('Error: ' + error.message);
          checkoutBtn.disabled = false;
          checkoutBtn.textContent = 'Proceed to Checkout';
        }
      } catch (error) {
        console.error('Checkout error:', error);
        alert('An error occurred during checkout. Please try again.');
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = 'Proceed to Checkout';
      }
    }

    // Close modals on background click
    document.addEventListener('click', e => {
      if (e.target.classList.contains('modal')) {
        closeModal(e.target.id);
      }
    });

    // Close on escape
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal.active').forEach(modal => {
          closeModal(modal.id);
        });
        closeLightbox();
        if (document.getElementById('cart-sidebar').classList.contains('active')) {
          toggleCart();
        }
      }
    });

    // Lightbox keyboard navigation
    document.addEventListener('keydown', e => {
      if (document.getElementById('lightbox').classList.contains('active')) {
        if (e.key === 'ArrowLeft') lightboxPrev();
        if (e.key === 'ArrowRight') lightboxNext();
      }
    });

    // Check URL parameters on page load
    function checkURLParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('product');

      // If product parameter exists and is valid, open that modal
      if (productId && products[productId]) {
        openModal(productId);
      }
    }

    // Handle browser back/forward buttons
    window.addEventListener('popstate', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('product');

      // Close all modals first
      document.querySelectorAll('.modal.active').forEach(modal => {
        modal.classList.remove('active');
      });
      document.body.style.overflow = '';

      // Open modal if product parameter exists
      if (productId && products[productId]) {
        document.getElementById(productId).classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    });

    // Initialize
    generateModals();
    updateCartUI();
    checkURLParams();
  </script>

</body>
</html>